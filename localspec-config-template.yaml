# LocalSpec 配置文件模板
# 位置: .localspec/config.yaml
# 复制此文件到你的项目 .specify/ 目录下

# ============== 模型配置 ==============
model:
  # 默认模型
  name: "qwen2.5-coder:14b-q5_k_m"

  # Ollama API 地址
  api_base: "http://localhost:11434"

  # 模型参数
  temperature: 0.3        # 创造性 (0.0-1.0)，代码生成建议 0.1-0.5
  max_tokens: 4096        # 最大生成长度
  top_p: 0.9              # 核采样
  top_k: 40               # Top-K 采样
  repeat_penalty: 1.1     # 重复惩罚

  # 请求超时（秒）
  timeout: 300

  # 针对不同任务使用不同模型（可选）
  tasks:
    constitution: "qwen2.5-coder:14b-q5_k_m"   # 宪法生成
    specify: "qwen2.5-coder:32b-q5_k_m"        # 规范生成（大模型）
    clarify: "qwen2.5-coder:14b-q5_k_m"        # 澄清
    plan: "qwen2.5-coder:32b-q5_k_m"           # 计划生成（大模型）
    tasks: "qwen2.5-coder:14b-q5_k_m"          # 任务分解
    implement: "qwen2.5-coder:14b-q5_k_m"      # 代码实现（中型模型）
    chat: "qwen2.5-coder:7b-q4_k_m"            # 聊天（小模型，快速响应）

# ============== 项目信息 ==============
project:
  name: "my-project"
  type: "web"              # web/api/desktop/mobile/cli
  language: "zh-CN"        # 主要语言（zh-CN/en-US）
  primary_tech: "Python"   # 主要技术栈

  # 团队信息
  team:
    size: 5                # 团队规模
    roles:                 # 角色列表
      - "后端开发"
      - "前端开发"
      - "测试工程师"

# ============== Spec Kit 集成 ==============
speckit:
  # 目录配置
  templates_dir: ".specify/templates"
  specs_dir: ".specify/specs"
  memory_dir: ".specify/memory"

  # 规范版本控制
  versioning:
    enabled: true
    format: "YYYY-MM-DD-v{number}"  # 如: 2025-01-15-v001

  # 自动编号
  numbering:
    format: "{number:03d}"          # 如: 001, 002, 003
    start_from: 1

# ============== 工作流配置 ==============
workflow:
  # 自动化选项
  auto_clarify: true                # 规范生成后自动运行澄清
  auto_validate: true               # 自动验证规范质量
  auto_git_branch: true             # 自动创建 Git 分支
  auto_git_commit: false            # 自动提交（不推荐）

  # TDD 配置
  tdd:
    enabled: true                   # 启用测试驱动开发
    test_first: true                # 先写测试再写实现
    min_coverage: 80                # 最低覆盖率（%）

  # 代码生成
  code_generation:
    include_comments: true          # 生成代码注释
    include_docstrings: true        # 生成文档字符串
    include_type_hints: true        # 生成类型注解
    style_guide: "pep8"             # 代码风格（pep8/google/airbnb）

# ============== 输出配置 ==============
output:
  # 显示选项
  stream: true                      # 流式输出
  verbose: false                    # 详细日志
  color: true                       # 彩色输出
  emoji: true                       # 使用 emoji

  # 格式化
  format: "markdown"                # 输出格式（markdown/json/plain）
  line_length: 80                   # 每行最大长度

  # 保存选项
  save_history: true                # 保存对话历史
  history_dir: ".localspec/history"
  max_history: 100                  # 最多保留历史记录数

# ============== 性能优化 ==============
performance:
  # 缓存配置
  cache_enabled: true
  cache_dir: ".localspec/cache"
  cache_ttl: 3600                   # 缓存有效期（秒）
  cache_strategy: "smart"           # smart/aggressive/conservative

  # 并行处理
  parallel_tasks: 2                 # 并行任务数（根据 CPU 核心数）
  max_workers: 4                    # 最大工作进程数

  # 上下文管理
  context_window: 8192              # 上下文窗口大小
  context_mode: "smart"             # smart/minimal/full
  max_context_files: 10             # 最多加载文件数

# ============== 提示词模板 ==============
prompts:
  # 自定义提示词目录
  custom_dir: ".localspec/prompts"

  # 系统提示词前缀
  system_prefix: |
    你是一个专业的软件工程师和架构师。
    请使用中文回答，输出清晰、结构化的内容。

  # 各命令的提示词文件（可选）
  templates:
    constitution: "custom-constitution.txt"
    specify: "custom-specify.txt"
    plan: "custom-plan.txt"
    # 如果不指定，使用默认模板

# ============== 集成配置 ==============
integrations:
  # Git 集成
  git:
    enabled: true
    branch_prefix: "feature/"       # 分支前缀
    commit_template: |              # 提交信息模板
      {type}: {message}

      Generated by LocalSpec

  # VS Code 集成
  vscode:
    enabled: false
    extension_id: "localspec.vscode-localspec"
    keybindings:
      specify: "ctrl+shift+s"
      plan: "ctrl+shift+p"
      chat: "ctrl+shift+c"

  # Webhook（可选）
  webhooks:
    on_spec_created: ""             # 规范创建后的 webhook
    on_plan_created: ""             # 计划创建后的 webhook
    on_implement_done: ""           # 实现完成后的 webhook

# ============== 通知配置 ==============
notifications:
  # 启用通知
  enabled: false

  # 通知渠道
  channels:
    email:
      enabled: false
      smtp_host: ""
      smtp_port: 587
      from_address: ""
      to_addresses: []

    slack:
      enabled: false
      webhook_url: ""

    dingtalk:
      enabled: false
      webhook_url: ""
      secret: ""

  # 通知事件
  events:
    spec_created: true
    plan_created: true
    tasks_generated: true
    implementation_done: true
    error_occurred: true

# ============== 质量控制 ==============
quality:
  # 规范检查
  spec_validation:
    check_completeness: true        # 检查完整性
    check_clarity: true             # 检查清晰度
    check_testability: true         # 检查可测试性
    max_clarifications: 3           # 最多澄清次数

  # 代码检查
  code_validation:
    run_linters: true               # 运行代码检查工具
    linters:                        # 检查工具列表
      - "flake8"
      - "pylint"
      - "mypy"
    fix_auto: false                 # 自动修复

  # 测试检查
  test_validation:
    run_tests: true                 # 运行测试
    min_coverage: 80                # 最低覆盖率
    fail_on_error: true             # 测试失败时停止

# ============== 日志配置 ==============
logging:
  # 日志级别
  level: "INFO"                     # DEBUG/INFO/WARNING/ERROR

  # 日志文件
  file: ".localspec/logs/localspec.log"
  max_size: "10MB"                  # 单个日志文件最大大小
  backup_count: 5                   # 保留日志文件数量

  # 日志格式
  format: "[{time}] {level} - {message}"

  # 敏感信息过滤
  filter_sensitive: true

# ============== 安全配置 ==============
security:
  # API 密钥加密
  encrypt_keys: true

  # 敏感信息检测
  scan_secrets: true
  secret_patterns:                  # 敏感信息正则
    - "password\\s*=\\s*['\"].*?['\"]"
    - "api[_-]?key\\s*=\\s*['\"].*?['\"]"
    - "token\\s*=\\s*['\"].*?['\"]"

  # 代码安全扫描
  security_scan:
    enabled: false
    tools:
      - "bandit"                    # Python 安全扫描
      - "safety"                    # 依赖漏洞检查

# ============== 实验性功能 ==============
experimental:
  # 多模型集成
  multi_model: false

  # 自动重试（失败时）
  auto_retry:
    enabled: true
    max_attempts: 3
    backoff_factor: 2               # 退避因子（秒）

  # 智能上下文选择
  smart_context: true

  # 代码优化建议
  code_suggestions: false

# ============== 调试配置 ==============
debug:
  enabled: false

  # 保存原始请求和响应
  save_raw: false
  raw_dir: ".localspec/debug"

  # 性能分析
  profiling: false
  profile_dir: ".localspec/profiles"

  # 详细错误信息
  verbose_errors: true
